<!DOCTYPE html>
<html>
    <head>
        <meta charset=utf-8>
        <title>Flag - construção de geometria</title>
        <style>
            body {
                margin: 0;
            }

            canvas {
                width: 100%;
                height: 100%
            }
        </style>
    </head>
    <body>
        <script src="js/three.js"></script>
        <script src="js/OrbitControls.js"></script>
        <script>

            // Our Javascript will go here. 

            var scene = new THREE.Scene();
            var camera = new THREE.PerspectiveCamera(75,window.innerWidth / window.innerHeight,0.1,1000);
            var renderer = new THREE.WebGLRenderer({
                antialias: true
            });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setClearColor(0x220000);
            document.body.appendChild(renderer.domElement);

            var geo = new THREE.Geometry();

            for (i = 0; i < 50; i++)
                for (j = 0; j < 50; j++) {
                    geo.vertices.push(new THREE.Vector3(i,j,Math.sin(Math.PI * i / 12.5)))
                    //geo.colors.push( new THREE.Color(0xff0000) ) 
                    geo.colors.push(new THREE.Color(i / 50.0,0.8 * j / 50.0,0))
                }

            for (i = 0; i < 49; i++)
                for (j = 0; j < 49; j++) {
                    face = new THREE.Face3(i * 50 + j,i * 50 + j + 1,i * 50 + j + 50)
                    geo.faces.push(face)
                    //face.color=new THREE.Color(0xffff00);
                    face.vertexColors[0] = geo.colors[i * 50 + j];
                    face.vertexColors[1] = geo.colors[i * 50 + j + 1];
                    face.vertexColors[2] = geo.colors[i * 50 + j + 50];

                    face = new THREE.Face3(i * 50 + j + 50 + 1,i * 50 + j + 50,i * 50 + j + 1,)
                    face.vertexColors[0] = geo.colors[i * 50 + j + 50 + 1];
                    face.vertexColors[1] = geo.colors[i * 50 + j + 50];
                    face.vertexColors[2] = geo.colors[i * 50 + j + 1];
                    geo.faces.push(face)
                }

            geo.computeFaceNormals()
            geo.computeVertexNormals()

            geo.colorsNeedUpdate = true;
            geo.verticesNeedUpdate = true;
            geo.dynamic = true;

            var mesh = new THREE.Mesh(geo,new THREE.MeshPhongMaterial({
                vertexColors: THREE.VertexColors,
                //flatShading: true,
                side: THREE.DoubleSide,
                //color:0x00f5f5,
            }))
            scene.add(mesh)

            var axesHelper = new THREE.AxesHelper(5);
            scene.add(axesHelper);

            var light = new THREE.PointLight(0xffffff,1.0);
            light.position.set(20, 20, 10);
            scene.add(light)

            var amblight = new THREE.AmbientLight(0x444444);
            scene.add(amblight)

            camera.position.x = 40;
            camera.position.z = 50;
            camera.position.y = -30;
            camera.up = new THREE.Vector3(0,0,1);
            camera.lookAt(new THREE.Vector3(0,0,0));

            var controls = new THREE.OrbitControls(camera);

            var t = 0;

            function animate() {
                requestAnimationFrame(animate);
                controls.update()
                //camera.lookAt(new THREE.Vector3(0, 0, 0))

                for (i = 0; i < 50; i++)
                    for (j = 0; j < 50; j++) {
                        geo.vertices[i * 50 + j].set(i, j, Math.sin(Math.PI * i / 12.5 + t))
                    }
                geo.dynamic = true
                geo.verticesNeedUpdate = true

                renderer.render(scene, camera);
                t = t + 0.1;

            }

            animate();
        </script>
    </body>
</html>
