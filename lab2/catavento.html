
<!DOCTYPE html> 
<html> 
<head> 
<meta charset=utf-8> 
<title>Flag - construção de geometria</title> 
<style> 
  body { margin: 0; } 
  canvas { width: 100%; height: 100% } 
</style> 
</head> 
<body> 
<script src="js/three.js"></script> 
<script src="js/OrbitControls.js"></script> 
<script> 

  // Our Javascript will go here. 

  var scene = new THREE.Scene();
  var camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 1000 );
  var renderer = new THREE.WebGLRenderer({antialias: true}); 
  renderer.setSize( window.innerWidth, window.innerHeight );
  renderer.setClearColor(0x220000);
  document.body.appendChild( renderer.domElement );

  var geo= new THREE.Geometry();

  function define_index(x,n=50) {
    return (2*n+1-x)*x/2;
  }

  var raio = 50/(Math.PI+1);
  var cont1 = 0;
  var cont2 = 0;
  for (x=0; x<50; x++){
    var x1 = x;
    var z1 = 0;
    if(x < raio){
      x1 = x;
      z1 = 0;
    } else if(x < raio + raio/2*Math.PI){
      x1 = raio + raio/2*Math.sin(cont1*2/raio);
      z1 = raio/2 - raio/2*Math.cos(cont1*2/raio);
      cont1 = cont1 + 1;
    } else {
      x1 = raio - raio*Math.sin(cont2/raio);
      z1 = raio*Math.cos(cont2/raio);
      cont2 = cont2 + 1;
    }

    for (y=0; y<50-x; y++)
    {
      geo.vertices.push( new THREE.Vector3(x1,y,z1))
      geo.colors.push( new THREE.Color(0xff0000))  
      //THREE.Color( z/12.5, z/12.5, 0.6 ) 
    }
  }
    
  for (x=0; x<49; x++)
    for (y=0; y<49-x; y++)
    {
      face=new THREE.Face3(define_index(x)+y,define_index(x)+y+1, define_index(x+1)+y)
      geo.faces.push( face )
      face.color=new THREE.Color(0xffff00);
      //face.vertexColors[0]=geo.colors[i*50+j];
      //face.vertexColors[1]=geo.colors[i*50+j+1];
      //face.vertexColors[2]=geo.colors[i*50+j+50];
      
      //face=new THREE.Face3(i*50+j+50+1,  i*50+j+50, i*50+j+1,)
  	  //geo.faces.push( face )
  	}

  //geo.computeFaceNormals()
  geo.computeVertexNormals()
  	
  geo.colorsNeedUpdate=true;
  	
  var mesh = new THREE.Mesh( geo, 
    new THREE.MeshBasicMaterial({
       vertexColors: THREE.VertexColors,
  	 flatShading: true,
       side: THREE.DoubleSide,
  	 //color:0x00f5f5,
  	 }) 
   )
  var a = mesh.clone()
  a.rotation.z = Math.PI/2
  
  var b = mesh.clone()
  b.rotation.z = 3*Math.PI/2
  
  var c = mesh.clone()
  c.rotation.z = Math.PI
  
  var fanGroup = new THREE.Group()
  fanGroup.add(a)
  fanGroup.add(b)
  fanGroup.add(c)
  fanGroup.add(mesh)
  scene.add(fanGroup)

  var axesHelper = new THREE.AxesHelper( 5 );
  scene.add( axesHelper );

  var light =  new THREE.PointLight( 0xffffff, 1.0 );
  //light.position={ x: 2, y:1, z: 3};
  light.position.set(4,4,2);


  scene.add(light)
  camera.position.x = 40;
  camera.position.z = 50;
  camera.position.y = -30;
  camera.up = new THREE.Vector3(0,0,1);
  camera.lookAt(new THREE.Vector3(0, 0, 0));

  var controls = new THREE.OrbitControls( camera );


  var t=0;

  function animate() { 
    requestAnimationFrame( animate ); 
    controls.update()
    //camera.lookAt(new THREE.Vector3(0, 0, 0))
    renderer.render( scene, camera ); 
    t=t+0.01;
    fanGroup.rotation.z = t;
  } 

  animate();


</script> 
</body> 
</html>